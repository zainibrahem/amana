import React from 'react';
import dynamic from 'next/dynamic';
import NavLink from 'components/nav-link/nav-link';
import { OFFER_MENU_ITEM, HELP_MENU_ITEM } from 'site-settings/site-navigation';
import LanguageSwitcher from '../language-switcher/language-switcher';
import { HelpIcon } from 'assets/icons/HelpIcon';
import { RightMenuBox } from './right-menu.style';
import Popover from 'components/popover/popover';
import * as categoryMenuIcons from 'assets/icons/category-menu-icons';
import Router, { useRouter } from 'next/router';
import { CATEGORY_MENU_ITEMS } from 'site-settings/site-navigation';
import { MenuDown } from 'assets/icons/MenuDown';
import { FormattedMessage } from 'react-intl';
import {
  MainMenu,
  MenuItem,
  IconWrapper,
  SelectedItem,
  Icon,
  Arrow,
  LeftMenuBox,
} from '../left-menu/left-menu.style';
const AuthMenu = dynamic(() => import('../auth-menu'), { ssr: false });

type Props = {
  onLogout: () => void;
  onJoin: () => void;
  avatar: string;
  isAuthenticated: boolean;
};
const CategoryIcon = ({ name }) => {
  const TagName = categoryMenuIcons[name];
  return !!TagName ? <TagName /> : <p>Invalid icon {name}</p>;
};
export const RightMenu: React.FC<Props> = ({
  onLogout,
  avatar,
  isAuthenticated,
  onJoin,
}) => {
  const router = useRouter();
  const initialMenu = CATEGORY_MENU_ITEMS.find(
    (item) => item.href === router.asPath
  );
  const [activeMenu, setActiveMenu] = React.useState(
    initialMenu ?? CATEGORY_MENU_ITEMS[0]
  );
  const CategoryMenu = (props: any) => {
    const handleOnClick = (item) => {
      if (item.dynamic) {
        Router.push('/[type]', `${item.href}`);
        props.onClick(item);
        return;
      }
      Router.push(`${item.href}`);
      props.onClick(item);
    };
  
    return (
      <div style={{ display: 'flex', flexDirection: 'column' }}>
        {CATEGORY_MENU_ITEMS.map((item) => (
          <MenuItem key={item.id} {...props} onClick={() => handleOnClick(item)}>
            <IconWrapper>
              <CategoryIcon name={item.icon} />
            </IconWrapper>
            <FormattedMessage id={item.id} defaultMessage={item.defaultMessage} />
          </MenuItem>
        ))}
      </div>
    );
  };
  
  return (
    <RightMenuBox>
      <div className="icons">
        <svg xmlns="http://www.w3.org/2000/svg" width="31.705" height="32" viewBox="0 0 31.705 32"><g id="Group_863" data-name="Group 863" transform="translate(0 0)"><path id="Path_4419" data-name="Path 4419" d="M139.2,160.733a1.6,1.6,0,0,0-1.9.316,1.3,1.3,0,0,0,.2,1.774C138.812,163.938,140.513,161.834,139.2,160.733Z" transform="translate(-127.077 -148.621)" fill="#313133"></path><path id="Path_4420" data-name="Path 4420" d="M255.975,230.027a1.339,1.339,0,0,0-.236.063c-.025,0-.05.013-.075.02l-.006,0a1.136,1.136,0,0,0-.69.588s0,0,0,0a1.2,1.2,0,0,0-.029,1.244c.013.022.032.038.046.059a1.482,1.482,0,0,0,.812.785,1.455,1.455,0,0,0,1.964-1.194A1.543,1.543,0,0,0,255.975,230.027Z" transform="translate(-236.138 -213.052)" fill="#313133"></path><path id="Path_4421" data-name="Path 4421" d="M33.626,13.754a.546.546,0,0,0-.192-.734A10.271,10.271,0,0,0,30.1,11.477a32.025,32.025,0,0,0,2.029-2.63.461.461,0,0,0-.4-.69c-.588.023-1.177.041-1.764.071a7.288,7.288,0,0,1-1.721.038.528.528,0,0,0-.118,0c.333-.874.627-1.765.93-2.65.155-.453.423-1.144-.182-1.409-.568-.249-1.631.275-2.173.435-.452.133-.905.284-1.355.443l-.228.06a21.355,21.355,0,0,0,.089-3.36c-.018-.316-.389-.615-.692-.4-1.024.736-2.055,1.49-3.025,2.3-.355-1.117-.747-2.225-1.135-3.328-.1-.3-.554-.515-.791-.209a26.89,26.89,0,0,0-1.875,2.427,20.919,20.919,0,0,0-2.1-2.416.505.505,0,0,0-.837.221,30.222,30.222,0,0,1-1.4,3.542c-.257-.216-.519-.428-.76-.649C12,2.732,11.426,2.169,10.861,1.6a.473.473,0,0,0-.738.1,5.34,5.34,0,0,0-.173,2.535c.023.317.026.739.077,1.144C9.074,5,8.11,4.659,7.16,4.3c-.372-.141-.691.273-.61.61A35.183,35.183,0,0,0,7.483,8.42a26.2,26.2,0,0,1-3.343-.393.494.494,0,0,0-.551.717,22.6,22.6,0,0,0,1.963,2.727c-.324.123-.641.276-.95.411-.795.346-1.571.729-2.335,1.14a.557.557,0,0,0,0,.952c.841.551,1.655,1.141,2.472,1.727-.828.662-1.64,1.344-2.5,1.973a.5.5,0,0,0,.119.908c.671.218,1.339.447,2,.7.371.14.743.315,1.12.464-.67.919-1.253,1.909-1.893,2.847a.517.517,0,0,0,.443.773c1.107,0,2.211.038,3.317.075-.249,1.017-.473,2.04-.729,3.056-.089.351.25.779.634.634L9.435,26.3c.209-.079.494-.149.765-.244-.17,1.2-.14,2.472-.246,3.671a.494.494,0,0,0,.619.472,5.81,5.81,0,0,0,1.787-1.116c.391-.272.852-.484,1.268-.742.264,1.1.716,2.2,1.006,3.285a.531.531,0,0,0,.957.125c.672-.951,1.412-1.919,2-2.934.158.253.328.5.487.745.416.64.833,1.28,1.268,1.907a.52.52,0,0,0,.888,0c.448-.935.864-1.9,1.253-2.864a9.887,9.887,0,0,0,.742.745c.558.5,1.524,1.431,2.321,1.2a.412.412,0,0,0,.268-.273.394.394,0,0,0,.106-.2,23.394,23.394,0,0,0,.37-3.956c.382.2.794.354,1.181.507.733.289,1.469.569,2.2.854a.5.5,0,0,0,.614-.614c-.269-.691-.541-1.377-.761-2.086-.122-.393-.216-.8-.332-1.2l-.025-.341c1.13.12,2.322.046,3.434.063a.527.527,0,0,0,.451-.787,29.614,29.614,0,0,0-1.79-2.739c.317-.1.63-.224.934-.327.66-.224,1.314-.464,1.968-.7a.557.557,0,0,0,.131-1,29.492,29.492,0,0,1-2.477-1.68A9.753,9.753,0,0,0,33.626,13.754ZM12.137,16.482a3.28,3.28,0,0,1-.764-.511c-1.867-1.663-1.681-4.988.852-5.855,2.355-.806,5.051.742,4.508,3.471C16.28,15.864,14.141,16.519,12.137,16.482Zm3.2,5.19a14.463,14.463,0,0,0-1.642.066c-.318.026-.656.049-.989.093A104.93,104.93,0,0,0,20.46,9.719c.45-.026.9-.065,1.348-.117A59.27,59.27,0,0,0,15.338,21.671Zm6.649.072a3.446,3.446,0,0,1-2.091-.421,3.719,3.719,0,0,1-.248-5.162,3.4,3.4,0,0,1,5.553.786C26.327,19.253,24.318,21.569,21.986,21.743Z" transform="translate(-1.999 -0.001)" fill="#313133"></path><path id="Path_4422" data-name="Path 4422" d="M269.77,372.68a0,0,0,0,0,0-.007" transform="translate(-250.025 -345.193)" fill="#313133"></path></g></svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="24.289" height="31.709" viewBox="0 0 24.289 31.709"><g id="Group_862" data-name="Group 862" transform="translate(0 0)"><g id="Group_861" data-name="Group 861" transform="translate(0 0)"><path id="Path_4417" data-name="Path 4417" d="M25.326,10.5H19.532v-.011H16.278a2.131,2.131,0,0,0,.467-.663,6.513,6.513,0,0,0,1.969-.264,9.236,9.236,0,0,0,2.229-.983A12.46,12.46,0,0,0,22.9,7.121c.308-.268.594-.554.875-.851a11.551,11.551,0,0,0,.818-.953A.815.815,0,0,0,24.5,4.241l-.049-.047c-.74-.691-1.492-1.363-2.255-2.026S20.654.86,19.872.222L19.832.19A.846.846,0,0,0,18.653.3c-.945,1.114-1.864,2.252-2.741,3.425-.439.589-.873,1.183-1.287,1.79-.137.2-.27.4-.4.6q-.541-.7-1.118-1.365c-.437-.5-.879-1.006-1.337-1.49s-.915-.964-1.384-1.433S9.44.889,8.959.435l0-.006A.811.811,0,0,0,7.809.467L7.761.52c-.7.737-1.367,1.492-2.029,2.254S4.426,4.312,3.786,5.1l-.038.049A.835.835,0,0,0,3.8,6.252,18.409,18.409,0,0,0,5.656,7.921,15.036,15.036,0,0,0,7.735,9.3a8.566,8.566,0,0,0,2.358.892,3.932,3.932,0,0,0,2.067-.078,2.142,2.142,0,0,0,.311.378H8.817V10.5H2.871a.916.916,0,0,0-.917.917V15.83a.914.914,0,0,0,.917.915H25.328a.912.912,0,0,0,.915-.915V11.416A.918.918,0,0,0,25.326,10.5ZM15.156,6c.568-.473,1.116-.959,1.657-1.456.868-.792,1.7-1.616,2.525-2.451.549.494,1.1.983,1.665,1.46s1.152.966,1.739,1.439c-.059.078-.116.156-.175.232-.232.289-.467.573-.712.852a16.624,16.624,0,0,1-1.58,1.566,12.045,12.045,0,0,1-1.819,1.3,8.933,8.933,0,0,1-1.644.721,2.1,2.1,0,0,0,.135-.752,2.189,2.189,0,0,0-2.185-2.189h-.478C14.581,6.485,14.873,6.246,15.156,6ZM10.315,9.5A10.664,10.664,0,0,1,8.4,8.268,21.769,21.769,0,0,1,6.676,6.745c-.357-.347-.712-.712-1.05-1.076.5-.562,1-1.128,1.492-1.7s.951-1.137,1.416-1.712c.29.23.579.463.871.685.526.4,1.063.8,1.6,1.185s1.094.763,1.65,1.131c.494.327.995.636,1.509.936-.118.178-.232.359-.347.541a2.184,2.184,0,0,0-1.75,3.229A4.589,4.589,0,0,1,10.315,9.5Zm1.133,6.517V11.659a1.465,1.465,0,0,1,.07-.44H18.1a1.475,1.475,0,0,1,.07.44v4.355Z" transform="translate(-1.954 0)" fill="#313133"></path><path id="Path_4418" data-name="Path 4418" d="M22.831,9.336H3.953a.915.915,0,0,0-.917.915V22.4a.911.911,0,0,0,.917.909h5.32v.013H19.989v-.013h2.844a.912.912,0,0,0,.915-.909V10.251A.912.912,0,0,0,22.831,9.336Zm-5.811.733V22.587H10.3V10.069Z" transform="translate(-0.982 8.388)" fill="#313133"></path></g></g></svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="15.898" height="18" viewBox="0 0 15.898 18"><path data-name="Path 2062" d="M3756.814,4042.745c-.321,1.887-1.279,2.844-2.816,2.832-1.495-.011-2.448-.987-2.74-2.8-.834-.14-1.684-.218-2.494-.44a7.131,7.131,0,0,1-1.956-.838,1.354,1.354,0,0,1-.333-2.139,7.716,7.716,0,0,0,1.7-4.647,16.446,16.446,0,0,1,.793-3.939,4.785,4.785,0,0,1,4.625-3.188,8.258,8.258,0,0,1,2.4.256,4.649,4.649,0,0,1,3.432,3.795c.3,1.292.441,2.62.646,3.934a7.247,7.247,0,0,0,.836,2.789,6.2,6.2,0,0,0,.573.74,1.577,1.577,0,0,1-.41,2.6,7.794,7.794,0,0,1-2.977.89C3757.661,4042.654,3757.234,4042.695,3756.814,4042.745Zm3.407-2.482a8.64,8.64,0,0,1-1.888-5.015c-.139-1.1-.309-2.195-.547-3.274a3.019,3.019,0,0,0-2.075-2.482,5.458,5.458,0,0,0-1.612-.264c-2.086.031-3.318.688-3.815,2.928-.259,1.167-.388,2.365-.561,3.55a7.6,7.6,0,0,1-1.781,4.458c-.022.023-.019.071-.026.1C3749.689,4041.453,3758.313,4041.456,3760.221,4040.263Zm-4.717,2.583h-2.94a1.47,1.47,0,1,0,2.94,0Z" transform="translate(-3746.087 -4027.577)" fill="currentColor"></path></svg>
      </div>
        <MainMenu>
        <Popover
          className='right'
          handler={
            <SelectedItem>
              <span>
                <Icon>
                  <CategoryIcon name={activeMenu?.icon} />
                </Icon>
                <span>
                  <FormattedMessage
                    id={activeMenu?.id}
                    defaultMessage={activeMenu?.defaultMessage}
                  />
                </span>
              </span>
              <Arrow>
                <MenuDown />
              </Arrow>
            </SelectedItem>
          }
          content={<CategoryMenu onClick={setActiveMenu} />}
        />
      </MainMenu>
      {/* <NavLink
        className="menu-item"
        href={OFFER_MENU_ITEM.href}
        label={OFFER_MENU_ITEM.defaultMessage}
        intlId={OFFER_MENU_ITEM.id}
      />
      <NavLink
        className="menu-item"
        href={HELP_MENU_ITEM.href}
        label={HELP_MENU_ITEM.defaultMessage}
        intlId={HELP_MENU_ITEM.id}
        iconClass="menu-icon"
        icon={<HelpIcon />}
      /> */}
      <LanguageSwitcher />

      <AuthMenu
        avatar={avatar}
        onJoin={onJoin}
        onLogout={onLogout}
        isAuthenticated={isAuthenticated}
      />
    </RightMenuBox>
  );
};
